# Logrotate configuration for Autoheal audit trail
# Rotates /data/audit.jsonl daily with 14-day retention

/data/audit.jsonl {
    # Rotate daily
    daily
    
    # Keep 14 days of rotated logs
    rotate 14
    
    # Compress rotated logs with gzip
    compress
    delaycompress
    
    # Copy and truncate (safe for append-only logging)
    copytruncate
    
    # Don't error if log file is missing
    missingok
    
    # Don't rotate empty log files
    notifempty
    
    # Create new log files with specific permissions
    create 0644 root root
    
    # Date extension for rotated files (YYYYMMDD)
    dateext
    dateformat -%Y%m%d
    
    # Shared scripts for all rotations
    sharedscripts
    
    # Post-rotation script (optional: upload to S3/backup)
    postrotate
        # Uncomment to backup to cloud storage
        # rclone copy /data/audit.jsonl-* remote:aetherlink-backups/autoheal/
        /bin/true
    endscript
}
